---
name: polish-episode
description: 既存エピソードの軽量改稿（ダッシュ削減・色彩挿入・能動性追加）を行う。引数にエピソード番号を指定（例: /polish-episode 1）
---

# /polish-episode — 既存エピソード ポリッシュスキル

## 概要

既存エピソードに対して、プロット変更なしの軽量改稿（ダッシュ削減、色彩挿入、文体改善）を実行する。作者エージェント（novel-author）が改稿し、タツヤ（novel-reader-vet）が整合性をチェックする。チームは使用せず、サブエージェントのみで完結する。

## 引数

- `$ARGUMENTS` — エピソード番号（例: `1`）。必須

## 前提条件

- `episodes/` に対象エピソードのファイルが存在すること
- `workspace/episode-diagnostic.md` が存在すること（診断レポート）

## 実行手順

引数からエピソード番号を取得してください。以下の全ステップを**自動的に**順次実行してください。

***

### Step 0: 初期化

1. Glob で `episodes/` を検索し、対象エピソード番号のファイルを特定する
   - ファイル命名規則: `{番号:2桁}_{タイトル}.txt`
   - 存在しない場合はエラー報告して中断
2. 対象ファイルのパスとタイトルを記録する
3. `mkdir -p archive/episode-{番号:2桁}/pre-polish` でアーカイブディレクトリを作成
4. 対象エピソードを `archive/episode-{番号:2桁}/pre-polish/{ファイル名}` にバックアップコピー
5. workspace/ に作業ファイルが残っている場合はクリーンする（Glob で検索し、存在するファイルのみ `rm -f`）
6. 対象エピソードを `workspace/current-draft.txt` にコピー（作業用）

***

### Step 1: ポリッシュ指示書の作成

リーダー（あなた自身）が以下を直接実行する:

1. `workspace/current-draft.txt` を Read で読む
2. `workspace/episode-diagnostic.md` を Read で読み、対象話のレポートカードを確認する
3. 以下の定量チェックを Grep で実行する:
   - ダッシュ（`——`）の出現箇所と行番号を取得
   - 灰色系色彩語（`灰|灰色|灰白|鈍色`）の出現数を確認
   - 非灰色の環境色彩語の有無を確認
4. `story/characters.md` と `story/setting.md` を参照し、キャラクター固有色（銀髪、紫瞳、碧眼、赤髪等）と環境色を区別する
5. 以下のテンプレートに従い `workspace/polish-instructions.md` を作成する

**ポリッシュ指示書テンプレート**:

```markdown
# ポリッシュ指示書 — 第{番号}話「{タイトル}」

## 絶対ルール
- プロットの変更禁止（登場・退場・発見・決戦等の物語イベントは一切変えない）
- 具体的な台詞の大意を変えない（言い回しの微調整は可）
- シーン順序の変更禁止
- 文字数は現在の ±10% の範囲に収める

## 必須修正

### 1. ダッシュ削減（現在{X}箇所 → 目標5箇所以下）

**残すダッシュ**（効果的な使用。以下の用途のみ残す）:
- 沈黙・絶句の表現（「——」単体で余白を演出するもの）
- 台詞の劇的な中断（直前に重大な情報がある場合）
- 最大5箇所まで。優先度の高いものから選定

**削除・置換するダッシュ**:
{各ダッシュについて、行番号・該当テキスト・置換方法を列挙}

置換テクニック:
- 体言止め: 「〜だった——」→「〜だった。」
- 三点リーダー: 思考の途切れには「……」
- 読点による接続: 「A——Bだ」→「A、Bだ」
- 句点で文を分割: 「A——Bが見えた」→「Aだった。Bが見えた」
- 削除（冗長なもの）: ダッシュなしでも意味が通る場合

### 2. 色彩挿入（該当する場合のみ）

現状: {灰色系X箇所 / 環境色の有無}

{色彩が不足している場合のみ以下を記載}
挿入候補:
- L{行番号}付近: {シーン描写}に{色}を追加（例: 夕焼けの橙、苔の緑、空の青）
- 自然な描写として挿入する。取ってつけた感を避ける

## 推奨修正（可能であれば）

### 3. 主人公能動性（該当する場合のみ）

{診断で能動性がNG/低の場合のみ記載}
- 現状: {蓮の能動的判断の有無}
- 追加候補: {シーン}で蓮が{能動的行動}を取る描写を追加
  - 既存の行動を能動的な内面描写で補強する手法を推奨

### 4. キャラ間横関係（該当する場合のみ）

{診断で横関係がNGの場合のみ記載}
- 蓮が観察者に回るシーンで、他キャラの自律的行動を補強
  - 例: 既存の場面に1〜2文追加して、蓮を介さないキャラ間の反応を描写
  - プロット変更にならない範囲の微細な追加に限る

### 5. アッシュ登場演出（該当する場合のみ）

{診断でアッシュが「声のみ・危機時」固定の場合のみ記載}
- 現在のパターン: {分類}
- 変奏案: {代替パターン}（微小な台詞追加・削除のみ。プロット変更禁止）
```

6. 指示書の全ダッシュ箇所について、残す5箇所と削除する箇所を具体的に判断する
7. `workspace/polish-instructions.md` を Write で出力する

***

### Step 2: 作者エージェントによる改稿

作者エージェント（novel-author）をサブエージェントとしてスポーンし、改稿を実行させる。

**Task スポーン**（subagent_type: novel-author, model: opus）:

```
既存エピソードのポリッシュ（軽量改稿）を行ってください。

以下のファイルを読み込んでください:
- agents/author.md（あなたの役割定義）
- workspace/polish-instructions.md（ポリッシュ指示書 — これが最優先の指針です）
- workspace/current-draft.txt（改稿対象のテキスト）
- story/writing-guide.md（文体ガイド）
- story/characters.md（キャラクター設定 — 口調の確認用）

## 改稿の絶対ルール
1. プロットの変更禁止。物語イベント（登場・退場・発見・決戦・情報開示）は一切変えない
2. 台詞の大意を変えない。言い回しの微調整は可
3. シーン順序の変更禁止
4. 文字数は現在の ±10% の範囲に収める

## 作業手順
1. polish-instructions.md の「必須修正」を全て実行する
2. 「推奨修正」は可能な範囲で実行する
3. 修正箇所に【ポリッシュ修正】等のマーカーは入れない。自然な文章として完成させる

結果を workspace/current-draft.txt に上書きしてください。
本文のみを出力し、メタ情報やコメントは含めないでください。
完了したら報告してください。
```

作者からの結果を待ち、`workspace/current-draft.txt` の出力を検証する:
- ファイルが存在し、実質的な内容があるか
- 検証失敗時は最大2回リトライ

***

### Step 3: タツヤ（整合性チェック）

タツヤ（novel-reader-vet）をサブエージェントとしてスポーンし、改稿前後の整合性を確認させる。

**Task スポーン**（subagent_type: novel-reader-vet）:

```
エピソードのポリッシュ（軽量改稿）の整合性チェックを行ってください。

以下のファイルを読み込んでください:
- archive/episode-{番号:2桁}/pre-polish/{ファイル名}（改稿前のテキスト）
- workspace/current-draft.txt（改稿後のテキスト）
- story/setting.md（世界観設定）
- story/characters.md（登場人物）
- story/episode-summaries.md（各話あらすじ — 前後の話との連続性確認用）

## チェック項目

以下の4点を確認し、結果を workspace/polish-review.md に出力してください:

1. **プロット不変**: 出来事の順序・内容が変わっていないか
   - 登場・退場・発見・決戦・情報開示のイベントが保持されているか
   - シーンの順序が変わっていないか

2. **キャラクター口調**: 各キャラクターの口調が崩れていないか
   - 蓮: 標準的な男子高校生の口調
   - ルナ: 短文で端的
   - ガルド: 男らしく荒っぽい
   - ミレーヌ: ビジネスライクで皮肉屋
   - アッシュ: 古風で尊大

3. **後続話との整合性**: 後続話で参照される台詞・行動が改変されていないか
   - episode-summaries.md に記載された重要イベントとの整合

4. **設定矛盾**: 新たな設定矛盾が発生していないか
   - setting.md / characters.md との矛盾がないか

## 出力フォーマット

workspace/polish-review.md に以下の形式で出力してください:

```markdown
# ポリッシュ整合性チェック — 第{番号}話

## 判定: [OK / 要修正]

## 1. プロット不変: [OK / NG]
{問題があれば具体的に指摘}

## 2. キャラクター口調: [OK / NG]
{問題があれば具体的に指摘}

## 3. 後続話との整合性: [OK / NG]
{問題があれば具体的に指摘}

## 4. 設定矛盾: [OK / NG]
{問題があれば具体的に指摘}

## 備考
{その他の所見}
```

問題がなければ「判定: OK」としてください。
```

タツヤからの結果を待ち、`workspace/polish-review.md` の出力を検証する。

***

### Step 4: リーダー確認・確定

リーダー（あなた自身）が以下を直接実行する:

1. `workspace/polish-review.md` を Read で確認
2. **タツヤ判定が「要修正」の場合**:
   - 指摘内容を確認し、プロット変更やキャラ口調崩壊がないか自分でも検証
   - 軽微な問題（1〜2箇所）→ 自分で直接 Edit で修正
   - 重大な問題（プロット変更等）→ 作者に再改稿を指示（Step 2 を再実行。最大1回）
   - 再実行後も問題がある場合 → バックアップから復元してユーザーに報告、中断
3. **タツヤ判定が「OK」の場合** → 以下の自動検証を実行

#### 自動検証

1. **ダッシュ数の確認**: Grep で `——` の出現数をカウント
   - 5回以下 → OK
   - 6回以上 → 警告表示（ユーザーに報告するが中断はしない）
2. **文字数の確認**: 改稿前後の文字数を比較
   - ±10% 以内 → OK
   - 超過 → 警告表示

***

### Step 5: 確定・保存

リーダー（あなた自身）が直接実行する:

1. `workspace/current-draft.txt` で `episodes/{番号:2桁}_{タイトル}.txt` を上書き
2. `story/quality-log.md` にポリッシュ記録を追記:
   - 既存のエントリがある場合: 「ポリッシュ」列を `○（polish）` に更新
   - 既存のエントリがない場合: 新規行を追加（リビジョン回数は `-`、判定は `POLISH`）
   以下の列情報:
   ```
   | 話数 | タイトル | リビジョン回数 | Manager判定 | ユウキ★ | サキ★ | タツヤ★ | 平均★ | 中央値★ | 議論回数 | ポリッシュ | 主要指摘 | 判定 |
   ```
   ポリッシュ専用のエントリは:
   ```
   | {話数} | {タイトル}（ポリッシュ） | - | - | - | - | - | - | - | - | ○ | ダッシュ削減 | POLISH |
   ```
3. workspace/ の作業ファイルをクリーン:
   - `polish-instructions.md`, `polish-review.md`, `current-draft.txt` を削除
4. ユーザーに完了報告

***

### 完了報告

以下の情報をユーザーに報告:

- 対象エピソード: 第{番号}話「{タイトル}」
- ダッシュ削減: {改稿前}回 → {改稿後}回
- 色彩挿入: {追加した色彩の概要}（該当する場合）
- 整合性チェック: {タツヤの判定}
- 文字数: {改稿前}字 → {改稿後}字（{差分%}）
- バックアップ: `archive/episode-{番号:2桁}/pre-polish/`
- 警告事項: {あれば}

***

## エラーハンドリング

- **エピソードファイルが見つからない場合**: エラーメッセージを表示して中断
- **診断レポートが存在しない場合**: 診断なしでもダッシュ削減は実行可能。色彩・構造系の推奨修正はスキップ
- **作者エージェントが2回リトライしても出力しない場合**: 中断してユーザーに報告
- **タツヤが「要修正」かつ再改稿後も問題がある場合**: バックアップから復元してユーザーに報告
